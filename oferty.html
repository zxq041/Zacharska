<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wszystkie oferty - Centrum nieruchomości</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .scrollbar-none::-webkit-scrollbar { display: none; }
    .scrollbar-none { -ms-overflow-style: none; scrollbar-width: none; }

    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    .animate-fade-in { animation: fadeIn 0.25s ease-out; }

    /* estetyczny input plików */
    .file-input::file-selector-button{
      margin-right: 12px;
      border: 0;
      background: #2563eb;
      color: #fff;
      padding: .5rem .9rem;
      border-radius: .6rem;
      cursor:pointer;
      font-weight:600;
    }
    .file-input:hover::file-selector-button{ background:#1d4ed8; }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-50 via-white to-blue-50 text-zinc-900">
  <div id="root"></div>

<script type="text/babel">
const { useEffect, useMemo, useRef, useState } = React;

// --- CONFIG ---
const API = {
  list: "/api/listings",
  one: (id)=>`/api/listings/${id}`,
  img: (id)=>`/api/images/${id}`,
  login: "/api/login",
  logout: "/api/logout"
};

// --- utils/ui ---
const cn = (...c) => c.filter(Boolean).join(" ");
const currency = (n)=> new Intl.NumberFormat("pl-PL",{style:"currency",currency:"PLN",maximumFractionDigits:0}).format(n);

const Icon = ({ name, className }) => {
  const icons = {
    MapPin: <><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>,
    Phone: <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>,
    Mail: <><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></>,
    Menu: <><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></>,
    Heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />,
    ChevronLeft: <path d="m15 18-6-6 6-6"/>,
    X: <><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>,
    Languages: <><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></>,
    Loader2: <path d="M21 12a9 9 0 1 1-6.219-8.56" />,
    Edit: <><path d="M12 20h9"/><path d="M16.5 3.5 20.5 7.5 7 21H3v-4z"/></>,
    Trash: <><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/></>,
    Upload: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>,
    Image: <><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-5-5L5 21"/></>
  };
  return <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={cn("h-4 w-4", className)}>{icons[name]}</svg>;
};

const Button = ({ variant="default", className, children, ...p })=>{
  const variants = {
    default: "bg-blue-600 text-white hover:bg-blue-700",
    outline: "border border-zinc-200 bg-transparent hover:bg-blue-50",
    ghost: "hover:bg-blue-100",
    danger: "bg-red-500 text-white hover:bg-red-600"
  };
  return <button className={cn("inline-flex items-center gap-2 rounded-md text-sm font-medium px-4 py-2 transition-colors", variants[variant], className)} {...p}>{children}</button>;
};

const Card = ({className, children})=> <div className={cn("rounded-2xl border bg-white/80 backdrop-blur shadow-sm", className)}>{children}</div>;
const CardHeader = ({children, className})=> <div className={cn("p-5 border-b", className)}>{children}</div>;
const CardContent = ({children, className})=> <div className={cn("p-5", className)}>{children}</div>;
const Input = (p)=> <input {...p} className={cn("w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500", p.className)}/>;
const Textarea = (p)=> <textarea {...p} className={cn("w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500", p.className)}/>;

// --- App ---
function App(){
  const path = window.location.pathname;
  const isPanelRoute = path === "/panel";

  return (
    <>
      <Header/>
      <main className="mx-auto max-w-7xl px-4 py-8">
        {isPanelRoute ? <AdminGate/> : <ClientView/>}
      </main>
      <Footer/>
    </>
  );
}

// --- Header/Footer (bez przycisku logowania) ---
function Header(){
  return (
    <header className="sticky top-0 z-50 backdrop-blur-xl bg-white/60 border-b border-zinc-200/70">
      <div className="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
        <a href="/oferty.html" className="flex items-center gap-3">
          <img src="https://i.imgur.com/UwnwhuV.png" className="h-12 w-12" alt="Logo"/>
          <div>
            <div className="font-semibold tracking-tight">Centrum nieruchomości</div>
            <div className="text-xs text-zinc-600">Zacharska Klaudia</div>
          </div>
        </a>
        <nav className="hidden md:flex items-center gap-6 text-sm">
          <a href="/oferty.html" className="relative py-1.5 after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-0 after:h-0.5 after:bg-blue-600 after:transition-all hover:after:w-full">Oferty</a>
          <a href="/#about" className="relative py-1.5 after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-0 after:h-0.5 after:bg-blue-600 after:transition-all hover:after:w-full">O nas</a>
          <a href="/#testimonials" className="relative py-1.5 after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-0 after:h-0.5 after:bg-blue-600 after:transition-all hover:after:w-full">Opinie</a>
          <a href="/#contact" className="relative py-1.5 after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-0 after:h-0.5 after:bg-blue-600 after:transition-all hover:after:w-full">Kontakt</a>
          <a href="/panel" className="text-zinc-500 hover:text-zinc-900">/panel</a>
        </nav>
      </div>
    </header>
  );
}

function Footer(){
  return (
    <footer className="py-10 border-t bg-white/60 backdrop-blur mt-10">
      <div className="mx-auto max-w-7xl px-4 flex flex-col items-center text-center gap-4 text-sm text-zinc-600">
        <div className="flex items-center gap-3">
          <img src="https://i.imgur.com/UwnwhuV.png" className="h-10 w-10" alt="Logo"/>
          <div>
            <div className="font-semibold tracking-tight">© {new Date().getFullYear()} Centrum nieruchomości</div>
            <div className="text-xs text-zinc-600">Zacharska Klaudia</div>
          </div>
        </div>
        <div className="flex items-center gap-4">
          <a href="#" className="hover:text-blue-600">Polityka prywatności</a>
          <a href="#" className="hover:text-blue-600">RODO</a>
        </div>
      </div>
    </footer>
  );
}

// --- CLIENT VIEW: list + modal with gallery ---
function ClientView(){
  const [items,setItems]=useState([]);
  const [loading,setLoading]=useState(true);
  const [selected,setSelected]=useState(null);

  useEffect(()=>{
    (async ()=>{
      try{
        const r = await fetch(API.list);
        const d = await r.json();
        setItems(d);
      }catch(e){ console.error(e); }
      finally{ setLoading(false); }
    })();
  },[]);

  return (
    <>
      <h1 className="text-3xl font-semibold tracking-tight">Wszystkie oferty</h1>
      {loading && <div className="mt-6 grid md:grid-cols-3 gap-4">{Array.from({length:6}).map((_,i)=><div key={i} className="h-80 rounded-2xl bg-zinc-200 animate-pulse"/>)}</div>}
      {!loading && items.length===0 && <div className="mt-6 p-4 bg-blue-50 rounded-xl text-blue-700">Brak ogłoszeń.</div>}
      <div className="mt-6 grid gap-4 md:grid-cols-3">
        {items.map(it=>(
          <Card key={it.id} className="overflow-hidden group cursor-pointer" onClick={()=>setSelected(it)}>
            <div className="relative h-56">
              {it.image_ids?.length ?
                <img src={API.img(it.image_ids[0])} className="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105" alt={it.title}/> :
                <div className="h-full w-full bg-zinc-200 grid place-items-center text-zinc-500"><Icon name="Image"/>&nbsp;Brak zdjęcia</div>
              }
              <div className="absolute left-3 top-3">
                <span className="text-xs px-2 py-1 rounded-full bg-black/70 text-white">{it.type}</span>
              </div>
            </div>
            <CardHeader>
              <div className="text-xl font-semibold">{it.title}</div>
              <div className="text-sm text-zinc-600 flex items-center gap-2 mt-1">
                <Icon name="MapPin"/>{it.city}{it.district?` • ${it.district}`:""} {it.street?` • ${it.street}`:""}
              </div>
            </CardHeader>
            <CardContent className="flex items-center justify-between">
              <div className="text-2xl font-semibold">{currency(it.price)}</div>
              <Button variant="outline">Szczegóły</Button>
            </CardContent>
          </Card>
        ))}
      </div>

      {selected && <DetailsModal item={selected} onClose={()=>setSelected(null)}/>}
    </>
  );
}

function DetailsModal({item,onClose}){
  const [idx,setIdx]=useState(0);
  const images = item.image_ids||[];

  useEffect(()=>{
    const onKey=(e)=>{
      if(e.key==="Escape") onClose();
      if(e.key==="ArrowRight") setIdx(i=> (i+1)%Math.max(images.length,1));
      if(e.key==="ArrowLeft") setIdx(i=> (i-1+Math.max(images.length,1))%Math.max(images.length,1));
    };
    window.addEventListener("keydown",onKey);
    return ()=> window.removeEventListener("keydown",onKey);
  },[images.length,onClose]);

  return (
    <div className="fixed inset-0 bg-black/70 z-[100] grid place-items-center p-4 animate-fade-in" onClick={onClose}>
      <div className="bg-white rounded-2xl max-w-5xl w-full overflow-hidden" onClick={(e)=>e.stopPropagation()}>
        <div className="relative w-full h-96 bg-black">
          {images.length? (
            <img src={API.img(images[idx])} alt="" className="w-full h-full object-cover"/>
          ) : (
            <div className="w-full h-full grid place-items-center text-white/70"><Icon name="Image" className="h-8 w-8"/> Brak zdjęć</div>
          )}
          {images.length>1 && (
            <>
              <button onClick={()=>setIdx((idx-1+images.length)%images.length)} className="absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-2"><Icon name="ChevronLeft"/></button>
              <button onClick={()=>setIdx((idx+1)%images.length)} className="absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-2"><svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m9 18 6-6-6-6"/></svg></button>
              <div className="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1">
                {images.map((_,i)=><div key={i} className={cn("w-2 h-2 rounded-full", i===idx? "bg-white":"bg-white/50")}></div>)}
              </div>
            </>
          )}
        </div>
        <div className="p-6 grid md:grid-cols-2 gap-6">
          <div>
            <h2 className="text-2xl font-semibold">{item.title}</h2>
            <div className="text-zinc-600 mt-1 flex items-center gap-2"><Icon name="MapPin"/>{item.city}{item.district?` • ${item.district}`:""} {item.street?` • ${item.street}`:""}</div>
            <div className="text-3xl font-bold mt-4">{currency(item.price)}</div>
            <div className="grid grid-cols-2 gap-3 text-sm mt-6">
              <div className="font-medium text-zinc-600">Typ</div><div>{item.type}</div>
              <div className="font-medium text-zinc-600">Metraż</div><div>{item.area} m²</div>
              <div className="font-medium text-zinc-600">Pokoje</div><div>{item.rooms}</div>
              <div className="font-medium text-zinc-600">Piętro</div><div>{item.floor ?? "-"}</div>
              <div className="font-medium text-zinc-600">Balkon</div><div>{item.balcony? "Tak":"Nie"}</div>
              <div className="font-medium text-zinc-600">Taras</div><div>{item.terrace? "Tak":"Nie"}</div>
              <div className="font-medium text-zinc-600">Ogród</div><div>{item.garden? "Tak":"Nie"}</div>
            </div>
          </div>
          <div>
            <h3 className="font-semibold text-lg">Opis</h3>
            <p className="mt-2 text-zinc-700 leading-relaxed whitespace-pre-wrap">{item.description || "Brak opisu."}</p>
          </div>
        </div>
        <div className="p-4 border-t flex justify-end">
          <Button variant="outline" onClick={onClose}><Icon name="X"/> Zamknij</Button>
        </div>
      </div>
    </div>
  );
}

// --- ADMIN: gate (login) + dashboard ---
function AdminGate(){
  const [ok,setOk]=useState(null); // null=nie próbował, true=authed, false=not
  const [pass,setPass]=useState("");
  const [error,setError]=useState("");

  // spróbuj załadować listę — jeśli 403, to nie zalogowany
  useEffect(()=>{
    (async ()=>{
      try{
        const r = await fetch(API.list, { credentials:"include" }); // publiczne, ale cookie pokaże w dalszym UI
        if(r.ok){ setOk(true); } else { setOk(false); }
      }catch{ setOk(false); }
    })();
  },[]);

  if(ok===true) return <AdminDashboard/>;
  // login form
  return (
    <div className="max-w-sm mx-auto mt-16 w-full">
      <Card>
        <CardHeader>
          <h2 className="text-2xl font-semibold text-center">Panel administratora</h2>
        </CardHeader>
        <CardContent>
          <form onSubmit={async (e)=>{
            e.preventDefault();
            setError("");
            const r = await fetch(API.login,{
              method:"POST",
              headers:{ "Content-Type":"application/json" },
              credentials:"include",
              body: JSON.stringify({ password: pass })
            });
            if(r.ok){ window.location.reload(); }
            else { setError("Nieprawidłowe hasło"); }
          }} className="space-y-3">
            <Input type="password" placeholder="Wpisz hasło" value={pass} onChange={(e)=>setPass(e.target.value)} required/>
            {error && <div className="text-red-600 text-sm">{error}</div>}
            <Button type="submit" className="w-full"><Icon name="Loader2" className="hidden group-[&:has(.loading)]:block"/>Zaloguj</Button>
            <div className="text-xs text-zinc-500 text-center">Podaj tylko hasło. Dostęp chroniony cookie.</div>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}

function AdminDashboard(){
  const blank = { title:"", city:"", district:"", street:"", price:"", rooms:"", area:"", type:"Mieszkanie", floor:"", balcony:false, terrace:false, garden:false, description:"" };
  const [form,setForm]=useState(blank);
  const [files,setFiles]=useState([]);
  const [list,setList]=useState([]);
  const [loading,setLoading]=useState(true);
  const [editing,setEditing]=useState(null);
  const [removeImgs,setRemoveImgs]=useState([]); // ids to remove when editing
  const fileRef = useRef(null);

  const load = async ()=>{
    setLoading(true);
    const r = await fetch(API.list, { credentials:"include" });
    const d = await r.json();
    setList(d);
    setLoading(false);
  };
  useEffect(()=>{ load(); },[]);

  const submit = async (e)=>{
    e.preventDefault();
    const fd = new FormData();
    Object.entries(form).forEach(([k,v])=>{
      if(typeof v==="boolean") fd.append(k, String(v));
      else fd.append(k, v??"");
    });
    if(editing && removeImgs.length) fd.append("remove_images", JSON.stringify(removeImgs));
    (files||[]).forEach(f=> fd.append("images", f));
    const url = editing? API.one(editing.id) : API.list;
    const method = editing? "PUT" : "POST";
    const r = await fetch(url, { method, body: fd, credentials:"include" });
    if(r.ok){
      setForm(blank); setFiles([]); setEditing(null); setRemoveImgs([]);
      if(fileRef.current) fileRef.current.value="";
      await load();
    } else {
      alert("Błąd zapisu.");
    }
  };

  const startEdit = (it)=>{
    setEditing(it);
    setForm({
      title: it.title||"", city: it.city||"", district: it.district||"", street: it.street||"",
      price: it.price||"", rooms: it.rooms||"", area: it.area||"", type: it.type||"Mieszkanie",
      floor: it.floor??"", balcony: !!it.balcony, terrace: !!it.terrace, garden: !!it.garden,
      description: it.description||""
    });
    setFiles([]);
    setRemoveImgs([]);
    if(fileRef.current) fileRef.current.value="";
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  const del = async (id)=>{
    if(!confirm("Usunąć ogłoszenie?")) return;
    const r = await fetch(API.one(id), { method:"DELETE", credentials:"include" });
    if(r.ok) load(); else alert("Błąd usuwania");
  };

  const logout = async ()=>{
    await fetch(API.logout,{ method:"POST", credentials:"include" });
    window.location.href="/panel";
  };

  return (
    <div className="space-y-8">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-semibold">Panel administratora</h1>
        <Button variant="outline" onClick={logout}>Wyloguj</Button>
      </div>

      <Card>
        <CardHeader><div className="text-xl font-semibold">{editing? "Edytuj ogłoszenie":"Dodaj ogłoszenie"}</div></CardHeader>
        <CardContent>
          <form onSubmit={submit} className="grid md:grid-cols-3 gap-4">
            <Input placeholder="Tytuł *" value={form.title} onChange={e=>setForm({...form,title:e.target.value})} required/>
            <Input placeholder="Miasto *" value={form.city} onChange={e=>setForm({...form,city:e.target.value})} required/>
            <Input placeholder="Dzielnica" value={form.district} onChange={e=>setForm({...form,district:e.target.value})}/>
            <Input placeholder="Ulica" value={form.street} onChange={e=>setForm({...form,street:e.target.value})}/>
            <Input type="number" placeholder="Cena (PLN) *" value={form.price} onChange={e=>setForm({...form,price:e.target.value})} required/>
            <Input type="number" placeholder="Pokoje *" value={form.rooms} onChange={e=>setForm({...form,rooms:e.target.value})} required/>
            <Input type="number" placeholder="Metraż (m²) *" value={form.area} onChange={e=>setForm({...form,area:e.target.value})} required/>
            <select className="rounded-md border px-3 py-2" value={form.type} onChange={e=>setForm({...form,type:e.target.value})}>
              <option>Mieszkanie</option><option>Dom</option><option>Apartament</option><option>Loft</option>
            </select>
            <Input type="number" placeholder="Piętro" value={form.floor} onChange={e=>setForm({...form,floor:e.target.value})}/>
            <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={form.balcony} onChange={e=>setForm({...form,balcony:e.target.checked})}/> Balkon</label>
            <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={form.terrace} onChange={e=>setForm({...form,terrace:e.target.checked})}/> Taras</label>
            <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={form.garden} onChange={e=>setForm({...form,garden:e.target.checked})}/> Ogród</label>
            <div className="md:col-span-3">
              <Textarea rows="4" placeholder="Opis" value={form.description} onChange={e=>setForm({...form,description:e.target.value})}/>
            </div>

            {/* ładny wybór plików (wiele) */}
            <div className="md:col-span-3">
              <label className="block text-sm font-medium mb-1">Zdjęcia (możesz wybrać wiele)</label>
              <input ref={fileRef} type="file" multiple accept="image/*" className="file-input w-full rounded-md border border-zinc-200 px-3 py-2 bg-white"/>
              <div className="text-xs text-zinc-500 mt-1">Do 12 plików, max 10 MB każdy.</div>
            </div>

            {/* podgląd nowych plików */}
            <div className="md:col-span-3 grid grid-cols-2 md:grid-cols-6 gap-2" id="newPreview"></div>

            <div className="md:col-span-3 flex gap-2">
              <Button type="submit"><Icon name="Upload"/>{editing? "Zapisz zmiany":"Dodaj ogłoszenie"}</Button>
              {editing && <Button type="button" variant="outline" onClick={()=>{setEditing(null); setForm(blank); setFiles([]); setRemoveImgs([]); if(fileRef.current) fileRef.current.value="";}}>Anuluj edycję</Button>}
            </div>
          </form>
        </CardContent>
      </Card>

      <section>
        <h2 className="text-xl font-semibold mb-3">Twoje ogłoszenia</h2>
        {loading && <div className="grid md:grid-cols-3 gap-4">{Array.from({length:6}).map((_,i)=><div key={i} className="h-56 rounded-2xl bg-zinc-200 animate-pulse"/>)}</div>}
        {!loading && list.length===0 && <div className="p-4 bg-blue-50 rounded-xl text-blue-700">Brak ogłoszeń.</div>}
        <div className="grid md:grid-cols-3 gap-4">
          {list.map(it=>(
            <Card key={it.id} className="overflow-hidden">
              <div className="relative h-40">
                {it.image_ids?.length ?
                  <img src={API.img(it.image_ids[0])} alt="" className="w-full h-full object-cover"/> :
                  <div className="h-full w-full bg-zinc-200 grid place-items-center text-zinc-500"><Icon name="Image"/>&nbsp;Brak zdjęcia</div>}
                <div className="absolute left-3 top-3">
                  <span className="text-xs px-2 py-1 rounded-full bg-black/70 text-white">{it.type}</span>
                </div>
              </div>
              <CardContent>
                <div className="font-semibold text-lg">{it.title}</div>
                <div className="text-sm text-zinc-600 mt-1">{it.city}{it.district?` • ${it.district}`:""} {it.street?` • ${it.street}`:""}</div>
                <div className="text-lg font-semibold mt-2">{currency(it.price)}</div>

                {editing?.id===it.id && it.image_ids?.length>0 && (
                  <div className="mt-3">
                    <div className="text-sm font-medium mb-1">Aktualne zdjęcia (kliknij, aby zaznaczyć do usunięcia):</div>
                    <div className="grid grid-cols-5 gap-2">
                      {it.image_ids.map(imgId=>{
                        const selected = removeImgs.includes(imgId);
                        return (
                          <button key={imgId} type="button" onClick={()=>{
                            setRemoveImgs((prev)=> prev.includes(imgId) ? prev.filter(x=>x!==imgId) : [...prev,imgId]);
                          }} className={cn("relative rounded overflow-hidden border", selected? "ring-2 ring-red-500":"")}>
                            <img src={API.img(imgId)} alt="" className="w-full h-16 object-cover"/>
                            {selected && <div className="absolute inset-0 bg-red-500/40"></div>}
                          </button>
                        );
                      })}
                    </div>
                    <div className="text-xs text-zinc-500 mt-1">Zaznaczone zostaną usunięte po zapisaniu zmian.</div>
                  </div>
                )}

                <div className="mt-3 flex gap-2">
                  <Button variant="outline" onClick={()=>startEdit(it)}><Icon name="Edit"/>Edytuj</Button>
                  <Button variant="danger" onClick={()=>del(it.id)}><Icon name="Trash"/>Usuń</Button>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </section>
    </div>
  );
}

// obsługa wyboru plików (podgląd miniatur)
document.addEventListener("change",(e)=>{
  if(e.target && e.target.type==="file"){
    const cont = document.getElementById("newPreview");
    if(cont) cont.innerHTML="";
    const files = e.target.files || [];
    const arr = Array.from(files);
    const evt = new CustomEvent("files-selected",{ detail: arr });
    window.dispatchEvent(evt);
    if(cont){
      arr.slice(0,12).forEach(f=>{
        const url = URL.createObjectURL(f);
        const div = document.createElement("div");
        div.className = "relative rounded overflow-hidden border";
        div.innerHTML = `<img src="${url}" class="w-full h-20 object-cover"/>`;
        cont.appendChild(div);
      });
    }
  }
});

// Przekaż pliki do React (AdminDashboard)
(function bridgeFiles(){
  let filesHandlers = [];
  window.addEventListener("files-selected",(e)=>{
    filesHandlers.forEach(fn=>fn(e.detail));
  });
  // expose
  window.__registerFilesHandler = fn => filesHandlers.push(fn);
})();

</script>

<script type="text/babel">
/* mostek: przypisz handler plików do aktualnego formularza */
(function useFilesToForm(){
  // znajdź najbliższy komponent AdminDashboard i podmień jego setFiles gdy zmieni się input
  const hook = ()=>{
    const reactRoot = document.getElementById("root");
    // nic nie trzeba – emitujemy globalnie, a w komponencie pobierzemy
  };
  hook();
})();
</script>

<script type="text/babel">
// Patch: wpięcie handlera do AdminDashboard(setFiles)
const _origCreateElement = React.createElement;
React.createElement = function(type, props, ...children){
  const el = _origCreateElement(type, props, ...children);
  // po zamontowaniu AdminDashboard dołączymy nasłuch
  if(type && type.name==="AdminDashboard"){
    const refSetter = (inst)=>{
      if(!inst) return;
      const setFiles = inst?.props?.children?.props?.setFiles;
    };
  }
  return el;
};
</script>

<script type="text/babel">
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
